---
layout:     post
title:      "Activity生命周期"
subtitle:   "Activity生命周期总结"
date:       2018-10-13
author:     "袁平"
header-img: "img/tag-bg.jpg"
tags:
    - Android
---

# 前言

`Activity`生命周期讲解

--------------------

# 正文

--------------

## 一. 概述

本文将分析和总结各种情况下, `Activity`的生命周期情况, 包括正常情况下, 异常情况下(如: 用户屏幕旋转, 资源分配不足等)以及特殊情况下(如: 当`Activity`上覆盖对话框或者透明`Activity`, 当按下`Home`键回到桌面时, 当屏幕熄灭时)`Activity`生命周期的调用情况; 同时还将简述各个方法下适于做什么工作等


--------------------------

## 二. 正常情况

### 2.1 单独的Activity分析

如下为一张典型的`Activity`生命周期图(摘自官方文档); 也是正常情况下, 一个`Activity`的经历

![Activity生命周期](/img/post/Activity/Activity生命周期.png)

> 记忆的时候可以通过两两配对来记

下面将结合上图讲解各个状态:

1. `onCreate()`: 一个`Activity`启动时只调用一次, 表示`Activity`创建; 可以进行一些数据绑定, 类变量初始化或者上一次`UI`恢复等工作(通过`savedInstanceState`实现)

2. `onStart()`: 可见, 处于后台, 不能交互

3. `onResume()`: 可见, 处于前台

4. `onPause()`: 时间短暂, 处于后台; 如果在`onPause`的时候再快速的回到当前`Activity`, 那么`onResume`会被调用(一般用户操作很难实现这一场景); 在`Android7.0`或者更高, 应用可以在多窗口模式下运行, 但是只要每个时刻只有一个应用可以得到焦点, 那么此时就需要暂停另一个应用(处于`onPause()`状态); (一个处于onPause状态的Activity可能仍然是完全可见的, 比如说在多窗口模式下); 不应该在`onPause()`执行数据保存工作, 因为该阶段非常短暂, 同时只有`onPause()`执行完,
   新`Activity`的`onResume()`才会执行

5. `onStop()`: 不可见, 可以执行一些稍微重量级的工作, 比如资源释放与数据保存

6. `onDestroy()`: 表示`Activity`销毁, 可以做一些最终的回收工作和资源释放

7. `onRestart()`: 表示当当前`Activity`从不可见重新变为可见状态时调用


### 2.2 Activity启动新Activity分析

> 这里以Activity A正常启动Activity B的情况分析

当`A`启动`B`的时候, 会依次执行`A.onPause()` --> `B.onCreate()` --> `B.onStart()` --> `B.onResume()` --> `A.onStop()`

可以看出, 只有当`A`的`onPause()`方法执行完成之后, `B`的一系列方法才会调用; 这也说明了`onPause()`方法中不能执行耗时操作, 因为新`Activity`的`onResume()`是在其之后执行的, 如果`onPause()`中执行太耗时的操作的话, 会影响新`Activity`的显示; 我们应当尽量在`onStop()`中操作, 使新`Activity`尽快显示出来并出现在前台

-------------------

## 三. 异常情况

###  3.1 资源相关系统配置改变导致Activity被杀死并重新创建




















关于是否可见和是否可以和用户交互可以通过打断点的方式来逐步调试


onStart(): 

onResume(): 处于前台, 可以和用户交互


onStop(): 不再可见; 执行数据保存与资源释放

onDestroy(): 

参见照片, 系统杀死Activity

方法执行顺序:
1. Activity A的onPause()执行
2. Activity B的onCreate(), onStart(), onResume()执行(B拥有用户焦点)
3. A不再可见, onStop()执行




看: https://developer.android.com/topic/libraries/architecture/lifecycle#java
