---
layout:     post
title:      "iOS数据存储"
subtitle:   "iOS数据存储相关"
date:       2019-02-26
author:     "袁平"
header-img: "img/tag-bg.jpg"
tags:
    - iOS
---

> 1. 沙盒
> 2. Plist
> 3. Preference偏好设置
> 4. NSKeyedArchiver归档 / NSKeyedUnarchiver解档
> 5. SQLite3的使用
> 6. FMDB
> 7. Core Data
> 8. Realm: https://realm.io/cn/docs/swift/latest/

--------------

## 一. 沙盒

文件系统：
`APFS`是`macOS`, `iOS`, `watchOS`, 和`tvOS`的默认文件系统；从`iOS 10.3`及其之后，`APFS`就替代`HFS+`作为默认的文件系统

`iOS App`的沙盒目录如下
![](/img/post/iOS_Storage/iOS_App_SandBox.png)
应用程序通常不能在自己的沙盒之外进行文件操作，但是可以通过通过系统接口来获取信息，如通过系统接口获取联系人信息和音乐等

常用沙盒文件夹：

| 目录 | 详情 |
| --   | --   |
| AppName.app | App Bundle，该目录包括了app及其所有资源文件；用户拥有只读权限（无写权限），该目录在app安装时被签名，如果强行写入该目录会破坏该签名，使得应用无法启动；该文件目录下内容不会被iTunes或iCloud备份 | 
| Documents | 用于存储用户生成的文件，该目录下的文件可以共享给其他用户；该文件目录下内容会被iTunes和iCloud备份 |
| Documens/Inbox | 用来保存由外部应用请求当前应用程序打开的文件；应用程序可以读取和删除该目录下文件，但是无法创建新文件和写入已经存在的文件；该目录下内容会被iTunes和iCloud备份 |
| Library | 用于存储非用户数据的文件，可以将不想暴露给用户的数据存储在该目录下；该目录下有一个Caches子目录，用于缓存，以及一个Application Supportm目录，用于存储应用生成的一些文件，如配置文件等；该目录下内容（除了Caches下内容外）会被iTunes和iCloud备份 |
| temp | 用于存储临时文件，当应用程序没有运行时，该目录下内容可能会被系统清空；该目录下内容不会被iTunes或iCloud备份 |

**备注** :
**Bundle** ：`bundle`是将可执行程序代码和相关资源文件（如图片，声音等）组合在一起的一个文件目录；在`iOS`和`OS X`中，应用程序，`frameworks`，插件和其他形式的软件都是`bundle`（应用程序是第三方开发者能够在`iOS`上创建的唯一`bundle`）；使用`bundle`可以使安装和定位应用程序更加方便，同时方便做国际化(`bundle`目录结构如下图)；每个应用程序都有一个`main bundle`，可以通过`NSBundle`来获取

![](/img/post/iOS_Storage/bundle.png)

获取各目录路径：[摘自博客](https://www.jianshu.com/p/dd3f120eb249)

```
// 获取沙盒主目录路径
NSString *homeDir = NSHomeDirectory();
// 获取Documents目录路径
NSString *docDir = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];
// 获取Library的目录路径
NSString *libDir = [NSSearchPathForDirectoriesInDomains(NSLibraryDirectory, NSUserDomainMask, YES) lastObject];
// 获取Caches目录路径
NSString *cachesDir = [NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES) firstObject];
// 获取tmp目录路径
NSString *tmpDir =  NSTemporaryDirectory();
```


----------------

## Core Data


---------------


## FMDB


------------

## Realm



-------------------

## 其他

------------

### Plist

只能存储`OC`常用数据类型(`NSString`、`NSDictionary`、`NSArray`、`NSData`、`NSNumber`等类型)而不能直接存储自定义模型对象；如果想存储自定义模型对象只能将自定义模型对象转换为字典存储（实现`writeToFile`方法）


### Preference

每个应用都有一个`NSUserDefaults`实例，可用于快速存储键值对，如：用户名，密码，开关状态等


### NSKeyedArchiver归档 / NSKeyedUnarchiver解档

归档和解档会在写入、读出数据之前进行序列化、反序列化，数据的安全性相对高一些；但是归档不能存储大批量数据（相比较`Sqlite`而言），存储数据到文件是将所有的数据一下子存储到文件中，从文件中读取数据也是一下子读取所有的数据；归档的类需要实现`NSCoding`协议


---------------

## 参考链接

1. https://www.jianshu.com/p/e88880be794f

2. https://www.jianshu.com/p/14fd706b632d
